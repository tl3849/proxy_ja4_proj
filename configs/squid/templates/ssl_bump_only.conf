# Basic Squid configuration with SSL bumping support
# This is a minimal configuration for testing

# Cache directory configuration
cache_dir ufs /var/cache/squid 100 16 256

# SSL bumping configuration - using certificate names
http_port 3128 ssl-bump cert=/shared_ca/proxy-ca.cert.pem key=/shared_ca/proxy-ca.key.pem generate-host-certificates=on dynamic_cert_mem_cache_size=4MB

# SSL certificate generation
sslcrtd_program /usr/lib/squid/security_file_certgen -s /var/cache/squid/ssl_db -M 4MB
sslcrtd_children 5 startup=1 idle=1

# Access control
acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http

# Deny requests to unsafe ports
http_access deny !Safe_ports

# Deny CONNECT to other than SSL ports
http_access deny CONNECT !SSL_ports

# SSL bump rules
acl step1 at_step SslBump1
ssl_bump peek step1
ssl_bump bump all

# Allow all other requests (for testing)
http_access allow all

# Logging
access_log /var/log/squid/access.log
cache_log /var/log/squid/cache.log

# Cache settings
cache_mem 256 MB
maximum_object_size 4096 KB

# User and group
cache_effective_user proxy
cache_effective_group proxy

# Pid file location
pid_filename /var/run/squid.pid
